<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Spring Beanæ‰§è¡Œå™¨</title>
    <link rel="stylesheet" href="/statics/css/bootstrap.min.css">
    <link rel="stylesheet" href="/statics/css/font-awesome.min.css">
    <link rel="stylesheet" href="/statics/css/AdminLTE.min.css">
    <link rel="stylesheet" href="/statics/css/all-skins.min.css">
    <style>
        * {
            box-sizing: border-box;
        }

        /* ç¡®ä¿æ‰€æœ‰å®¹å™¨ä¸ä¼šæº¢å‡º */
        .col-md-4, .col-md-6, .col-md-8 {
            box-sizing: border-box;
            overflow-x: hidden;
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .main-container {
            max-width: 1600px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            overflow: hidden;
        }

        .page-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .page-header h1 {
            font-size: 32px;
            font-weight: 600;
            margin: 0 0 10px 0;
        }

        .page-header p {
            opacity: 0.9;
            font-size: 14px;
            margin: 0;
        }

        .content-area {
            padding: 30px;
        }

        /* ä¼˜åŒ–åˆ—é—´è· */
        .row {
            margin-left: -10px;
            margin-right: -10px;
        }

        .row > [class*="col-"] {
            padding-left: 10px;
            padding-right: 10px;
        }

        /* ä¼˜åŒ–å¡ç‰‡é—´è· */
        .method-list-container {
            margin-top: 10px;
        }

        /* ç»Ÿä¸€æ ‡é¢˜æ ·å¼ */
        h5 {
            font-size: 16px;
            font-weight: 600;
            color: #333;
            margin-bottom: 15px;
            margin-top: 0;
        }

        .bean-card {
            margin-bottom: 15px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: white;
        }

        .bean-card:hover {
            border-color: #667eea;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
            transform: translateY(-2px);
        }

        .bean-card.selected {
            border-color: #667eea;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
        }

        .bean-card .bean-name {
            font-weight: 600;
            font-size: 16px;
            color: #333;
            margin-bottom: 8px;
        }

        .bean-card .bean-type {
            font-size: 13px;
            color: #666;
        }

        .bean-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
        }

        .badge-singleton {
            background: #d4edda;
            color: #155724;
        }

        .badge-prototype {
            background: #fff3cd;
            color: #856404;
        }

        .method-item {
            padding: 12px;
            border-bottom: 1px solid #e9ecef;
            cursor: pointer;
            transition: all 0.2s;
            border-radius: 6px;
            margin-bottom: 8px;
        }

        .method-item:hover {
            background-color: #f8f9fa;
            border-color: #667eea;
        }

        .method-item.selected {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
            border-color: #667eea;
        }

        .method-name {
            font-weight: 600;
            color: #333;
            margin-bottom: 4px;
        }

        .method-signature {
            font-size: 12px;
            color: #666;
            font-family: 'Courier New', monospace;
        }

        .method-return {
            font-size: 12px;
            color: #999;
        }

        .param-input {
            margin-bottom: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #e9ecef;
        }

        .param-label {
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
            display: block;
        }

        .param-type {
            font-size: 12px;
            color: #666;
            font-family: 'Courier New', monospace;
        }

        .execution-result {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
        }

        .search-box {
            margin-bottom: 20px;
        }

        /* ç»Ÿä¸€æœç´¢æ¡†å’ŒæŒ‰é’®çš„é«˜åº¦ */
        .input-group {
            display: flex;
            align-items: stretch;
            width: 100%;
            box-sizing: border-box;
        }

        .input-group .form-control {
            flex: 1;
            min-width: 0;
            box-sizing: border-box;
        }

        .input-group-btn {
            display: flex;
            align-items: stretch;
            flex-shrink: 0;
            box-sizing: border-box;
        }

        .input-group-btn .btn {
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            border-top-left-radius: 0;
            border-bottom-left-radius: 0;
            box-sizing: border-box;
        }

        .search-input {
            height: 42px;
            border-radius: 8px 0 0 8px;
            border: 2px solid #e9ecef;
            border-right: none;
            padding: 10px 15px;
            font-size: 14px;
            transition: all 0.3s;
            box-sizing: border-box;
            width: 100%;
        }

        .search-input:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
            outline: none;
            z-index: 1;
        }

        .btn-modern {
            height: 42px;
            min-width: 42px;
            max-width: 42px;
            border-radius: 0 8px 8px 0;
            padding: 0;
            font-weight: 600;
            font-size: 14px;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid #667eea;
            border-left: none;
            box-sizing: border-box;
            flex-shrink: 0;
        }

        /* æ‰§è¡Œæ–¹æ³•æŒ‰é’®ç‰¹æ®Šæ ·å¼ - è‡ªé€‚åº”å®½åº¦ */
        .btn-execute {
            height: 44px;
            min-width: auto;
            max-width: none;
            width: auto;
            border-radius: 8px;
            padding: 10px 24px;
            font-weight: 600;
            font-size: 15px;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            border: 2px solid #667eea;
            box-sizing: border-box;
            white-space: nowrap;
        }

        .btn-execute:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .btn-execute:active {
            transform: translateY(0);
        }

        .btn-execute i {
            margin-right: 8px;
        }

        .btn-modern:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .btn-modern:active {
            transform: translateY(0);
        }

        .btn-primary-modern {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-color: #667eea;
            color: white;
        }

        .btn-primary-modern:hover {
            background: linear-gradient(135deg, #5568d3 0%, #653a8f 100%);
            border-color: #5568d3;
            color: white;
        }

        /* ç¡®ä¿è¾“å…¥ç»„æŒ‰é’®ä¸è¾“å…¥æ¡†å®Œç¾å¯¹é½ */
        .input-group-btn {
            position: relative;
            width: auto;
        }

        .input-group-btn .btn {
            border-top-left-radius: 0;
            border-bottom-left-radius: 0;
            border-left: none;
            width: 100%;
        }

        /* ä¿®å¤ Bootstrap input-group çš„è¾¹æ¡†é—®é¢˜ */
        .input-group .form-control:first-child {
            border-top-right-radius: 0;
            border-bottom-right-radius: 0;
        }

        /* ç¡®ä¿æœç´¢æ¡†å®¹å™¨ä¸ä¼šæº¢å‡º */
        .search-box {
            width: 100%;
            box-sizing: border-box;
        }

        .search-box .input-group {
            width: 100%;
            max-width: 100%;
        }

        .pagination-container {
            text-align: center;
            margin-top: 20px;
        }

        .pagination > li > a {
            border-radius: 6px;
            margin: 0 4px;
            border: 1px solid #e9ecef;
            color: #667eea;
        }

        .pagination > li.active > a {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-color: #667eea;
        }

        .history-panel {
            background: white;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            margin-bottom: 15px;
        }

        .history-item {
            padding: 8px 12px;
            border-bottom: 1px solid #f0f0f0;
            cursor: pointer;
            transition: background 0.2s;
        }

        .history-item:hover {
            background: #f8f9fa;
        }

        .history-item:last-child {
            border-bottom: none;
        }

        .method-info-card {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
            border: 2px solid #667eea;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .method-info-card strong {
            color: #667eea;
        }

        .no-selection {
            text-align: center;
            padding: 60px 20px;
            color: #999;
        }

        .no-selection i {
            font-size: 64px;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        .section-title {
            font-size: 18px;
            font-weight: 600;
            color: #333;
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 2px solid #667eea;
        }

        .param-input-group {
            display: flex;
            align-items: stretch;
            gap: 0;
        }

        .param-input-group input {
            flex: 1;
            border-radius: 6px 0 0 6px;
            border-right: none;
        }

        .complex-param-btn {
            border-radius: 0 6px 6px 0;
            border-left: none;
            min-width: 42px;
            height: 38px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* ç»Ÿä¸€è¡¨å•æ§ä»¶é«˜åº¦ */
        .form-control {
            height: 38px;
            padding: 8px 12px;
            font-size: 14px;
            border-radius: 6px;
            border: 1px solid #e9ecef;
            transition: all 0.3s;
            line-height: 1.5;
        }

        .form-control:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
            outline: none;
        }

        textarea.form-control {
            height: auto;
            min-height: 100px;
            resize: vertical;
        }

        /* ç»Ÿä¸€æŒ‰é’®é«˜åº¦ */
        .btn {
            height: 38px;
            padding: 8px 16px;
            font-size: 14px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            border-radius: 6px;
            transition: all 0.3s;
            line-height: 1.5;
            white-space: nowrap;
        }

        .btn-xs {
            height: 24px;
            padding: 2px 8px;
            font-size: 11px;
            line-height: 1.2;
        }

        /* ç¡®ä¿å‚æ•°è¾“å…¥æ¡†ç»„ä¸­çš„æŒ‰é’®å’Œè¾“å…¥æ¡†é«˜åº¦ä¸€è‡´ */
        .param-input-group .form-control {
            height: 38px;
        }

        .param-input-group .btn {
            height: 38px;
        }

        .result-success {
            background: #d4edda;
            border-color: #28a745;
            color: #155724;
        }

        .result-error {
            background: #f8d7da;
            border-color: #dc3545;
            color: #721c24;
        }

        .code-block {
            background: #2d2d2d;
            color: #f8f8f2;
            padding: 15px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            max-height: 400px;
            overflow-y: auto;
            margin-top: 10px;
        }

        .loading-spinner {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid #f3f3f3;
            border-top: 2px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-left: 8px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .method-list-container {
            max-height: 500px;
            overflow-y: auto;
            padding-right: 10px;
        }

        .method-list-container::-webkit-scrollbar {
            width: 6px;
        }

        .method-list-container::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 3px;
        }

        .method-list-container::-webkit-scrollbar-thumb {
            background: #667eea;
            border-radius: 3px;
        }

        .method-list-container::-webkit-scrollbar-thumb:hover {
            background: #764ba2;
        }
    </style>
</head>
<body class="hold-transition skin-blue sidebar-mini">
<div class="main-container">
    <div class="page-header">
        <h1>ğŸš€ Spring Beanæ‰§è¡Œå™¨</h1>
        <p>ç®¡ç†å’Œæ‰§è¡ŒSpring Beanæ–¹æ³• - æ”¯æŒé‡è½½æ–¹æ³•ç²¾ç¡®åŒ¹é…</p>
    </div>

    <div class="content-area">
        <div class="row">
            <!-- Beanåˆ—è¡¨ -->
            <div class="col-md-4">
                <div class="section-title">ğŸ“¦ Beanåˆ—è¡¨</div>
                
                <!-- æœç´¢æ¡† -->
                <div class="search-box">
                    <div class="input-group" style="width: 100%;">
                        <input type="text" class="form-control search-input" id="beanSearchInput" placeholder="æœç´¢Beanåç§°æˆ–ç±»å‹..." style="flex: 1 1 auto;">
                        <span class="input-group-btn" style="flex: 0 0 auto;">
                            <button class="btn btn-primary-modern btn-modern" type="button" onclick="searchBeans()" style="width: 42px;">
                                <i class="fa fa-search"></i>
                            </button>
                        </span>
                    </div>
                </div>
                
                <!-- Beanæœç´¢å†å²è®°å½• -->
                <div id="beanSearchHistory" style="display: none;" class="history-panel">
                    <div style="padding: 10px; border-bottom: 1px solid #e9ecef; display: flex; justify-content: space-between; align-items: center;">
                        <strong><i class="fa fa-history"></i> æœç´¢å†å²</strong>
                        <button class="btn btn-xs btn-danger" onclick="clearAllBeanHistory()" title="æ¸…é™¤æ‰€æœ‰å†å²">
                            <i class="fa fa-trash"></i>
                        </button>
                    </div>
                    <div id="beanHistoryList" style="max-height: 150px; overflow-y: auto;">
                        <!-- å†å²è®°å½•å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
                    </div>
                </div>
                
                <!-- Beanåˆ—è¡¨å®¹å™¨ -->
                <div id="beanListContainer" class="method-list-container">
                    <!-- Beanåˆ—è¡¨å°†åœ¨è¿™é‡ŒåŠ¨æ€åŠ è½½ -->
                </div>
                
                <!-- åˆ†é¡µ -->
                <div class="pagination-container">
                    <ul class="pagination" id="beanPagination">
                        <!-- åˆ†é¡µå°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
                    </ul>
                </div>
            </div>

            <!-- æ–¹æ³•åˆ—è¡¨å’Œæ‰§è¡Œ -->
            <div class="col-md-8">
                <div class="section-title">âš¡ æ–¹æ³•æ‰§è¡Œ</div>
                
                <div id="methodSection" style="display: none;">
                    <!-- é€‰ä¸­çš„Beanä¿¡æ¯ -->
                    <div class="method-info-card">
                        <strong>é€‰ä¸­çš„Bean:</strong> <span id="selectedBeanName"></span><br>
                        <strong>ç±»å‹:</strong> <span id="selectedBeanType"></span>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <h5 style="margin-bottom: 15px;">å¯ç”¨æ–¹æ³•</h5>
                            
                            <!-- æ–¹æ³•æœç´¢æ¡† -->
                            <div class="search-box">
                                <div class="input-group" style="width: 100%;">
                                    <input type="text" class="form-control search-input" id="methodSearchInput" placeholder="æœç´¢æ–¹æ³•åç§°..." style="flex: 1 1 auto;">
                                    <span class="input-group-btn" style="flex: 0 0 auto;">
                                        <button class="btn btn-primary-modern btn-modern" type="button" onclick="searchMethods()" style="width: 42px;">
                                            <i class="fa fa-search"></i>
                                        </button>
                                    </span>
                                </div>
                            </div>
                            
                            <!-- æ–¹æ³•æœç´¢å†å²è®°å½• -->
                            <div id="methodSearchHistory" style="display: none; margin-bottom: 15px;" class="history-panel">
                                <div style="padding: 10px; border-bottom: 1px solid #e9ecef; display: flex; justify-content: space-between; align-items: center;">
                                    <strong><i class="fa fa-history"></i> æœç´¢å†å²</strong>
                                    <button class="btn btn-xs btn-danger" onclick="clearAllMethodHistory()" title="æ¸…é™¤æ‰€æœ‰å†å²">
                                        <i class="fa fa-trash"></i>
                                    </button>
                                </div>
                                <div id="methodHistoryList" style="max-height: 150px; overflow-y: auto;">
                                    <!-- å†å²è®°å½•å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
                                </div>
                            </div>
                            
                            <div id="methodList" class="method-list-container">
                                <!-- æ–¹æ³•åˆ—è¡¨å°†åœ¨è¿™é‡ŒåŠ¨æ€åŠ è½½ -->
                            </div>
                        </div>
                        
                        <!-- æ–¹æ³•æ‰§è¡ŒåŒºåŸŸ -->
                        <div class="col-md-6">
                            <div id="executionSection" style="display: none;">
                                <h5 style="margin-bottom: 15px;">æ–¹æ³•æ‰§è¡Œ</h5>
                                
                                <div id="methodInfo" class="method-info-card">
                                    <!-- æ–¹æ³•ä¿¡æ¯å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
                                </div>
                                
                                <div id="parameterInputs">
                                    <!-- å‚æ•°è¾“å…¥æ¡†å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
                                </div>
                                
                                <div style="text-align: center; margin-top: 20px;">
                                    <button class="btn btn-primary-modern btn-execute" onclick="executeMethod()">
                                        <i class="fa fa-play"></i> æ‰§è¡Œæ–¹æ³•
                                    </button>
                                </div>
                                
                                <div id="executionResult" class="execution-result" style="display: none;">
                                    <!-- æ‰§è¡Œç»“æœå°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div id="noBeanSelected" class="no-selection">
                    <i class="fa fa-hand-pointer-o"></i>
                    <p>è¯·ä»å·¦ä¾§é€‰æ‹©ä¸€ä¸ªBeanæ¥æŸ¥çœ‹å…¶æ–¹æ³•</p>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- å¤æ‚å‚æ•°è¾“å…¥æ¨¡æ€æ¡† -->
<div class="modal fade" id="complexParamModal" tabindex="-1" role="dialog">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                <button type="button" class="close" data-dismiss="modal" style="color: white; opacity: 0.8;">&times;</button>
                <h4 class="modal-title">å¤æ‚å‚æ•°è¾“å…¥</h4>
            </div>
            <div class="modal-body">
                <div id="complexParamContent">
                    <!-- å¤æ‚å‚æ•°è¾“å…¥å†…å®¹ -->
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">å–æ¶ˆ</button>
                <button type="button" class="btn btn-primary-modern btn-modern" onclick="confirmComplexParam()">ç¡®å®š</button>
            </div>
        </div>
    </div>
</div>

<script src="/statics/libs/jquery.min.js"></script>
<script src="/statics/libs/bootstrap.min.js"></script>
<script src="/statics/libs/app.min.js"></script>

<script>
// å…¨å±€å˜é‡
let currentPage = 1;
let pageSize = 50;
let currentSearch = '';
let selectedBeanName = '';
let selectedMethod = null;
let currentParamIndex = 0;
let allMethods = [];
let currentMethodSearch = '';
let beanSearchHistory = [];
let methodSearchHistory = [];

// é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
$(document).ready(function() {
    loadSearchHistory();
    loadBeans();
    
    // Beanæœç´¢æ¡†äº‹ä»¶
    $('#beanSearchInput').on('keypress', function(e) {
        if (e.which === 13) {
            searchBeans();
        }
    });
    
    $('#beanSearchInput').on('focus', function() {
        if (beanSearchHistory.length > 0) {
            showBeanSearchHistory();
        }
    });
    
    $('#beanSearchInput').on('blur', function() {
        setTimeout(function() {
            hideBeanSearchHistory();
        }, 200);
    });
    
    // æ–¹æ³•æœç´¢æ¡†äº‹ä»¶
    $('#methodSearchInput').on('keypress', function(e) {
        if (e.which === 13) {
            searchMethods();
        }
    });
    
    $('#methodSearchInput').on('input', function() {
        currentMethodSearch = $(this).val();
        filterMethods();
    });
    
    $('#methodSearchInput').on('focus', function() {
        if (methodSearchHistory.length > 0) {
            showMethodSearchHistory();
        }
    });
    
    $('#methodSearchInput').on('blur', function() {
        setTimeout(function() {
            hideMethodSearchHistory();
        }, 200);
    });
});

// åŠ è½½Beanåˆ—è¡¨
function loadBeans(page) {
    if (page === undefined) page = 1;
    currentPage = page;
    
    $.ajax({
        url: '/sys/exec/beans',
        method: 'GET',
        data: {
            current: page,
            size: pageSize,
            search: currentSearch
        },
        success: function(response) {
            if (response) {
                renderBeanList(response.records);
                renderPagination(response);
            }
        },
        error: function(xhr, status, error) {
            console.error('åŠ è½½Beanåˆ—è¡¨å¤±è´¥:', error);
            alert('åŠ è½½Beanåˆ—è¡¨å¤±è´¥: ' + error);
        }
    });
}

// æ¸²æŸ“Beanåˆ—è¡¨
function renderBeanList(beans) {
    const container = $('#beanListContainer');
    container.empty();
    
    if (beans.length === 0) {
        container.html('<div class="text-center text-muted" style="padding: 40px;">æ²¡æœ‰æ‰¾åˆ°Bean</div>');
        return;
    }
    
    beans.forEach(function(bean) {
        const beanCard = $('<div class="bean-card" data-bean-name="' + escapeHtml(bean.name) + '"></div>');
        beanCard.html(
            '<div class="bean-name">' + escapeHtml(bean.name) + '</div>' +
            '<div class="bean-type">' + escapeHtml(bean.simpleType) + '</div>' +
            '<div style="margin-top: 8px;">' +
            '<span class="bean-badge ' + (bean.singleton ? 'badge-singleton' : 'badge-prototype') + '">' +
            (bean.singleton ? 'å•ä¾‹' : 'åŸå‹') +
            '</span>' +
            '</div>'
        );
        
        beanCard.click(function() {
            selectBean(bean.name);
        });
        
        container.append(beanCard);
    });
}

// æ¸²æŸ“åˆ†é¡µ
function renderPagination(data) {
    const pagination = $('#beanPagination');
    pagination.empty();
    
    if (data.pages <= 1) {
        return;
    }
    
    // ä¸Šä¸€é¡µ
    if (data.current > 1) {
        pagination.append(
            '<li><a href="#" onclick="loadBeans(' + (data.current - 1) + '); return false;">&laquo;</a></li>'
        );
    }
    
    // é¡µç 
    const startPage = Math.max(1, data.current - 2);
    const endPage = Math.min(data.pages, data.current + 2);
    
    for (let i = startPage; i <= endPage; i++) {
        const activeClass = i === data.current ? 'active' : '';
        pagination.append(
            '<li class="' + activeClass + '">' +
            '<a href="#" onclick="loadBeans(' + i + '); return false;">' + i + '</a>' +
            '</li>'
        );
    }
    
    // ä¸‹ä¸€é¡µ
    if (data.current < data.pages) {
        pagination.append(
            '<li><a href="#" onclick="loadBeans(' + (data.current + 1) + '); return false;">&raquo;</a></li>'
        );
    }
}

// æœç´¢Bean
function searchBeans() {
    currentSearch = $('#beanSearchInput').val();
    
    if (currentSearch && currentSearch.trim() !== '') {
        addToBeanSearchHistory(currentSearch.trim());
    }
    
    loadBeans(1);
}

// é€‰æ‹©Bean
function selectBean(beanName) {
    selectedBeanName = beanName;
    
    $('.bean-card').removeClass('selected');
    $('.bean-card[data-bean-name="' + escapeHtml(beanName) + '"]').addClass('selected');
    
    $('#noBeanSelected').hide();
    $('#methodSection').show();
    
    $('#methodSearchInput').val('');
    currentMethodSearch = '';
    
    loadBeanMethods(beanName);
}

// åŠ è½½Beanæ–¹æ³•
function loadBeanMethods(beanName) {
    $.ajax({
        url: '/sys/exec/bean/methods',
        method: 'GET',
        data: { beanName: beanName },
        success: function(response) {
            if (response) {
                $('#selectedBeanName').text(response.beanName);
                $('#selectedBeanType').text(response.beanType);
                renderMethodList(response.methods);
            }
        },
        error: function(xhr, status, error) {
            console.error('åŠ è½½æ–¹æ³•åˆ—è¡¨å¤±è´¥:', error);
            alert('åŠ è½½æ–¹æ³•åˆ—è¡¨å¤±è´¥: ' + error);
        }
    });
}

// æ¸²æŸ“æ–¹æ³•åˆ—è¡¨
function renderMethodList(methods) {
    allMethods = methods;
    filterMethods();
}

// è¿‡æ»¤æ–¹æ³•
function filterMethods() {
    const methodList = $('#methodList');
    methodList.empty();
    
    let filteredMethods = allMethods;
    
    if (currentMethodSearch && currentMethodSearch.trim() !== '') {
        const searchTerm = currentMethodSearch.toLowerCase();
        filteredMethods = allMethods.filter(function(method) {
            return method.name.toLowerCase().includes(searchTerm) ||
                   (method.signature && method.signature.toLowerCase().includes(searchTerm)) ||
                   method.returnType.toLowerCase().includes(searchTerm);
        });
    }
    
    if (filteredMethods.length === 0) {
        methodList.html('<div class="text-muted" style="padding: 40px; text-align: center;">æ²¡æœ‰æ‰¾åˆ°æ–¹æ³•</div>');
        return;
    }
    
    filteredMethods.forEach(function(method) {
        const methodItem = $('<div class="method-item" data-method-id="' + (method.methodId || method.name) + '"></div>');
        
        const signature = method.signature || (method.name + '(' + method.parameterCount + 'å‚æ•°)');
        
        methodItem.html(
            '<div class="method-name">' + escapeHtml(method.name) + '</div>' +
            '<div class="method-signature">' + escapeHtml(signature) + '</div>' +
            '<div class="method-return">è¿”å›: ' + escapeHtml(method.returnType) + '</div>' +
            '<div style="margin-top: 4px;">' +
            '<span class="label label-info">' + method.parameterCount + ' å‚æ•°</span>' +
            '</div>'
        );
        
        methodItem.click(function() {
            selectMethod(method);
        });
        
        methodList.append(methodItem);
    });
}

// æœç´¢æ–¹æ³•
function searchMethods() {
    currentMethodSearch = $('#methodSearchInput').val();
    
    if (currentMethodSearch && currentMethodSearch.trim() !== '') {
        addToMethodSearchHistory(currentMethodSearch.trim());
    }
    
    filterMethods();
}

// é€‰æ‹©æ–¹æ³•
function selectMethod(method) {
    selectedMethod = method;
    
    $('.method-item').removeClass('selected');
    $('.method-item[data-method-id="' + (method.methodId || method.name) + '"]').addClass('selected');
    
    $('#executionSection').show();
    
    renderMethodInfo(method);
    renderParameterInputs(method);
    
    $('#executionResult').hide();
}

// æ¸²æŸ“æ–¹æ³•ä¿¡æ¯
function renderMethodInfo(method) {
    const methodInfo = $('#methodInfo');
    const signature = method.signature || (method.name + '(' + method.parameterCount + 'å‚æ•°)');
    
    methodInfo.html(
        '<div><strong>æ–¹æ³•å:</strong> ' + escapeHtml(method.name) + '</div>' +
        '<div style="margin-top: 8px;"><strong>ç­¾å:</strong> <code>' + escapeHtml(signature) + '</code></div>' +
        '<div style="margin-top: 8px;"><strong>è¿”å›ç±»å‹:</strong> <code>' + escapeHtml(method.fullReturnType) + '</code></div>' +
        '<div style="margin-top: 8px;"><strong>å‚æ•°æ•°é‡:</strong> ' + method.parameterCount + '</div>'
    );
}

// æ¸²æŸ“å‚æ•°è¾“å…¥æ¡†
function renderParameterInputs(method) {
    const parameterInputs = $('#parameterInputs');
    parameterInputs.empty();
    
    if (method.parameterCount === 0) {
        parameterInputs.html('<p class="text-muted" style="padding: 20px; text-align: center;">è¯¥æ–¹æ³•æ²¡æœ‰å‚æ•°</p>');
        return;
    }
    
    method.parameters.forEach(function(param, index) {
        const paramDiv = $('<div class="param-input"></div>');
        paramDiv.html(
            '<label class="param-label">' + escapeHtml(param.name) + ' <span class="param-type">(' + escapeHtml(param.type) + ')</span></label>' +
            '<div class="param-input-group">' +
            '<input type="text" class="form-control param-value" ' +
            'data-param-index="' + index + '" ' +
            'data-param-type="' + escapeHtml(param.fullType) + '" ' +
            'placeholder="è¾“å…¥å‚æ•°å€¼">' +
            '<button class="btn btn-default complex-param-btn" ' +
            'type="button" ' +
            'onclick="openComplexParamInput(' + index + ', \'' + escapeHtml(param.fullType) + '\')">' +
            '<i class="fa fa-cog"></i>' +
            '</button>' +
            '</div>' +
            '<small class="text-muted">ç±»å‹: <code>' + escapeHtml(param.fullType) + '</code></small>'
        );
        
        parameterInputs.append(paramDiv);
    });
}

// æ‰“å¼€å¤æ‚å‚æ•°è¾“å…¥
function openComplexParamInput(paramIndex, paramType) {
    currentParamIndex = paramIndex;
    
    let inputHtml = '';
    
    if (paramType.indexOf('List') !== -1 || paramType.indexOf('Set') !== -1) {
        inputHtml =
            '<div class="form-group">' +
            '<label>æ•°ç»„/é›†åˆå‚æ•° (JSONæ ¼å¼)</label>' +
            '<textarea class="form-control" id="complexParamValue" rows="5" ' +
            'placeholder=\'ä¾‹å¦‚: ["item1", "item2"] æˆ– [1, 2, 3]\'></textarea>' +
            '<small class="text-muted">è¯·è¾“å…¥JSONæ ¼å¼çš„æ•°ç»„æˆ–é›†åˆ</small>' +
            '</div>';
    } else if (paramType.indexOf('Map') !== -1) {
        inputHtml =
            '<div class="form-group">' +
            '<label>Mapå‚æ•° (JSONæ ¼å¼)</label>' +
            '<textarea class="form-control" id="complexParamValue" rows="5" ' +
            'placeholder=\'ä¾‹å¦‚: {"key1": "value1", "key2": "value2"}\'></textarea>' +
            '<small class="text-muted">è¯·è¾“å…¥JSONæ ¼å¼çš„Map</small>' +
            '</div>';
    } else {
        inputHtml =
            '<div class="form-group">' +
            '<label>å¤æ‚å¯¹è±¡å‚æ•° (JSONæ ¼å¼)</label>' +
            '<textarea class="form-control" id="complexParamValue" rows="5" ' +
            'placeholder=\'è¯·è¾“å…¥JSONæ ¼å¼çš„å¯¹è±¡\'></textarea>' +
            '<small class="text-muted">è¯·è¾“å…¥JSONæ ¼å¼çš„å¯¹è±¡</small>' +
            '</div>';
    }
    
    $('#complexParamContent').html(inputHtml);
    $('#complexParamModal').modal('show');
}

// ç¡®è®¤å¤æ‚å‚æ•°
function confirmComplexParam() {
    const value = $('#complexParamValue').val();
    if (value.trim()) {
        try {
            JSON.parse(value);
            $('.param-value[data-param-index="' + currentParamIndex + '"]').val(value);
            $('#complexParamModal').modal('hide');
        } catch (e) {
            alert('JSONæ ¼å¼é”™è¯¯ï¼Œè¯·æ£€æŸ¥è¾“å…¥');
        }
    } else {
        $('#complexParamModal').modal('hide');
    }
}

// æ‰§è¡Œæ–¹æ³•
function executeMethod() {
    if (!selectedMethod) {
        alert('è¯·å…ˆé€‰æ‹©ä¸€ä¸ªæ–¹æ³•');
        return;
    }
    
    const parameters = [];
    $('.param-value').each(function() {
        const value = $(this).val();
        const type = $(this).data('param-type');
        
        if (value.trim() === '') {
            parameters.push(null);
        } else {
            try {
                if (value.startsWith('[') || value.startsWith('{')) {
                    parameters.push(JSON.parse(value));
                } else {
                    parameters.push(value);
                }
            } catch (e) {
                parameters.push(value);
            }
        }
    });
    
    // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
    const resultDiv = $('#executionResult');
    resultDiv.show().html('<div class="text-center" style="padding: 20px;"><span class="loading-spinner"></span> æ‰§è¡Œä¸­...</div>');
    
    $.ajax({
        url: '/sys/exec/bean/execute',
        method: 'POST',
        contentType: 'application/json',
        data: JSON.stringify({
            beanName: selectedBeanName,
            methodName: selectedMethod.name,
            parameters: parameters
        }),
        success: function(response) {
            showExecutionResult(response);
        },
        error: function(xhr, status, error) {
            console.error('æ‰§è¡Œæ–¹æ³•å¤±è´¥:', error);
            showExecutionResult({
                success: false,
                message: 'æ‰§è¡Œå¤±è´¥: ' + error
            });
        }
    });
}

// æ˜¾ç¤ºæ‰§è¡Œç»“æœ
function showExecutionResult(result) {
    const resultDiv = $('#executionResult');
    
    if (result.success) {
        let returnValueStr = '';
        if (result.returnValue !== null) {
            if (typeof result.returnValue === 'object') {
                returnValueStr = JSON.stringify(result.returnValue, null, 2);
            } else {
                returnValueStr = String(result.returnValue);
            }
        } else {
            returnValueStr = 'null';
        }
        
        resultDiv.html(
            '<div class="result-success" style="padding: 15px; border-radius: 8px;">' +
            '<h4><i class="fa fa-check"></i> æ‰§è¡ŒæˆåŠŸ</h4>' +
            '<p><strong>è¿”å›ç±»å‹:</strong> <code>' + escapeHtml(result.returnType) + '</code></p>' +
            '<p><strong>è¿”å›å€¼:</strong></p>' +
            '<pre class="code-block">' + escapeHtml(returnValueStr) + '</pre>' +
            '</div>'
        );
    } else {
        resultDiv.html(
            '<div class="result-error" style="padding: 15px; border-radius: 8px;">' +
            '<h4><i class="fa fa-times"></i> æ‰§è¡Œå¤±è´¥</h4>' +
            '<p>' + escapeHtml(result.message) + '</p>' +
            (result.exception ? '<p><strong>å¼‚å¸¸ç±»å‹:</strong> ' + escapeHtml(result.exception) + '</p>' : '') +
            '</div>'
        );
    }
    
    resultDiv.show();
}

// HTMLè½¬ä¹‰å‡½æ•°
function escapeHtml(text) {
    if (text == null) return '';
    const map = {
        '&': '&amp;',
        '<': '&lt;',
        '>': '&gt;',
        '"': '&quot;',
        "'": '&#039;'
    };
    return String(text).replace(/[&<>"']/g, function(m) { return map[m]; });
}

// ==================== æœç´¢å†å²è®°å½•ç®¡ç† ====================

function loadSearchHistory() {
    try {
        const beanHistory = localStorage.getItem('beanSearchHistory');
        const methodHistory = localStorage.getItem('methodSearchHistory');
        
        if (beanHistory) {
            beanSearchHistory = JSON.parse(beanHistory);
        }
        
        if (methodHistory) {
            methodSearchHistory = JSON.parse(methodHistory);
        }
    } catch (e) {
        console.error('åŠ è½½æœç´¢å†å²å¤±è´¥:', e);
    }
}

function saveBeanSearchHistory() {
    try {
        localStorage.setItem('beanSearchHistory', JSON.stringify(beanSearchHistory));
    } catch (e) {
        console.error('ä¿å­˜Beanæœç´¢å†å²å¤±è´¥:', e);
    }
}

function saveMethodSearchHistory() {
    try {
        localStorage.setItem('methodSearchHistory', JSON.stringify(methodSearchHistory));
    } catch (e) {
        console.error('ä¿å­˜æ–¹æ³•æœç´¢å†å²å¤±è´¥:', e);
    }
}

function addToBeanSearchHistory(searchTerm) {
    beanSearchHistory = beanSearchHistory.filter(function(item) { return item !== searchTerm; });
    beanSearchHistory.unshift(searchTerm);
    if (beanSearchHistory.length > 10) {
        beanSearchHistory = beanSearchHistory.slice(0, 10);
    }
    saveBeanSearchHistory();
}

function addToMethodSearchHistory(searchTerm) {
    methodSearchHistory = methodSearchHistory.filter(function(item) { return item !== searchTerm; });
    methodSearchHistory.unshift(searchTerm);
    if (methodSearchHistory.length > 10) {
        methodSearchHistory = methodSearchHistory.slice(0, 10);
    }
    saveMethodSearchHistory();
}

function showBeanSearchHistory() {
    if (beanSearchHistory.length === 0) {
        return;
    }
    
    const historyList = $('#beanHistoryList');
    historyList.empty();
    
    beanSearchHistory.forEach(function(term, index) {
        const historyItem = $(
            '<div class="history-item">' +
            '<div style="display: flex; justify-content: space-between; align-items: center;">' +
            '<span><i class="fa fa-search"></i> ' + escapeHtml(term) + '</span>' +
            '<button class="btn btn-xs btn-danger" onclick="removeBeanHistoryItem(' + index + ')" title="åˆ é™¤">' +
            '<i class="fa fa-times"></i>' +
            '</button>' +
            '</div>' +
            '</div>'
        );
        
        historyItem.click(function(e) {
            if (!$(e.target).hasClass('btn') && !$(e.target).parent().hasClass('btn')) {
                $('#beanSearchInput').val(term);
                currentSearch = term;
                loadBeans(1);
                hideBeanSearchHistory();
            }
        });
        
        historyList.append(historyItem);
    });
    
    $('#beanSearchHistory').show();
}

function hideBeanSearchHistory() {
    $('#beanSearchHistory').hide();
}

function showMethodSearchHistory() {
    if (methodSearchHistory.length === 0) {
        return;
    }
    
    const historyList = $('#methodHistoryList');
    historyList.empty();
    
    methodSearchHistory.forEach(function(term, index) {
        const historyItem = $(
            '<div class="history-item">' +
            '<div style="display: flex; justify-content: space-between; align-items: center;">' +
            '<span><i class="fa fa-search"></i> ' + escapeHtml(term) + '</span>' +
            '<button class="btn btn-xs btn-danger" onclick="removeMethodHistoryItem(' + index + ')" title="åˆ é™¤">' +
            '<i class="fa fa-times"></i>' +
            '</button>' +
            '</div>' +
            '</div>'
        );
        
        historyItem.click(function(e) {
            if (!$(e.target).hasClass('btn') && !$(e.target).parent().hasClass('btn')) {
                $('#methodSearchInput').val(term);
                currentMethodSearch = term;
                filterMethods();
                hideMethodSearchHistory();
            }
        });
        
        historyList.append(historyItem);
    });
    
    $('#methodSearchHistory').show();
}

function hideMethodSearchHistory() {
    $('#methodSearchHistory').hide();
}

function removeBeanHistoryItem(index) {
    beanSearchHistory.splice(index, 1);
    saveBeanSearchHistory();
    showBeanSearchHistory();
}

function removeMethodHistoryItem(index) {
    methodSearchHistory.splice(index, 1);
    saveMethodSearchHistory();
    showMethodSearchHistory();
}

function clearAllBeanHistory() {
    beanSearchHistory = [];
    saveBeanSearchHistory();
    hideBeanSearchHistory();
}

function clearAllMethodHistory() {
    methodSearchHistory = [];
    saveMethodSearchHistory();
    hideMethodSearchHistory();
}
</script>
</body>
</html>
